# Top 10 Domain Controllers with Most High and Critical Vuln

### [+] Defender for Endpoint 
```
let AllDomainControllers =
     DeviceNetworkEvents
     | where LocalPort == 88
     | where LocalIPType == "FourToSixMapping"
     | summarize make_set(DeviceId);
DeviceTvmSoftwareVulnerabilities
| where VulnerabilitySeverityLevel has_any ('critical', 'High')
| where DeviceId has_any (AllDomainControllers)
| summarize count() by DeviceName, VulnerabilitySeverityLevel
| top 10 by count_ desc
| project DeviceName, VulnerabilitySeverityLevel, count_
| render piechart // Can remove this line to view table or replace piechart with a columnchart
```
:exclamation: **NOT** *available in Sentinel yet.*

### [+] Description
This KQL query is used to identify the top 10 Domain Controllers that have critical and high-level software vulnerabilities. It filters the software vulnerabilities based on their severity level and groups them by device name. It then displays the total count of critical and high-level vulnerabilities, along with the set of vulnerable CVEs, for each device. 

### [+] Recommended Actions
1. Review the list of vulnerabilities detected on each device and prioritize remediation efforts based on the severity and criticality of the vulnerabilities to the team who handles vulnerability management or patching.
2. Ensure to tell that team who is responsible to reach out to the end user to ensure that they are aware of the vulnerability and schedule a time to remediate the issue. If necessary, escalate the issue to the appropriate IT or security team.
