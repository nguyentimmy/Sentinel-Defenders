# Domain Controllers with the most vulnerabilities

### [+] Defender for Endpoint 
**Query 1**
```
let AllDomainControllers =
     DeviceNetworkEvents
     | where LocalPort == 88
     | where LocalIPType == "FourToSixMapping"
     | summarize make_set(DeviceId);
DeviceTvmSoftwareVulnerabilities
| where DeviceId has_any (AllDomainControllers)
| summarize TotalVulnerabilities = count(), VulnerabeCVE = make_set(CveId) by DeviceName
| sort by TotalVulnerabilities
```
**Query 2**
```
let DC =
     DeviceNetworkEvents
     | where LocalIPType == "FourToSixMapping"
     | where LocalPort == 88
     | summarize make_set(DeviceId);
DeviceTvmSoftwareVulnerabilities
| where DeviceId has_any (DC)
| summarize TotalVulnerabilities = count(), VulnerableCVEs = make_set(CveId) by DeviceName
| mv-expand VulnerableCVEs to typeof(string)
| project DeviceName, VulnerableCVEs
```
:exclamation: **NOT** *available in Sentinel yet.*

### [+] Description
This query finds Domain Controllers with the most vulnerability. It is important to patch software on domain controllers to address any known vulnerabilities that could potentially be exploited by attackers. Hackers often target domain controllers as a means of gaining access to sensitive information and systems within an organization. By keeping software up-to-date and patched, organizations can minimize the risk of attackers gaining access through known vulnerabilities. Additionally, patches may include security enhancements that can help protect against new or emerging threats.

### [+] Recommended Actions
1. Review the list of vulnerabilities detected on each device and prioritize remediation efforts based on the severity and criticality of the vulnerabilities to the team who handles vulnerability management or patching.
2. Ensure to tell that team who is responsible to reach out to the end user to ensure that they are aware of the vulnerability and schedule a time to remediate the issue. If necessary, escalate the issue to the appropriate IT or security team.

### [+] Resources
- Query1 Forked from directly from [@Bert-JanP](https://github.com/Bert-JanP), please give him credit and a follow!
