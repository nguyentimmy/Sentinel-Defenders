# Public Facing Device with Most Vuln

### [+] Defender for Endpoint 
**Query 1**
```
// Collect all internet facing devices
let InternetFacingDevices = DeviceInfo
| summarize arg_max(Timestamp, *) by DeviceId
| where IsInternetFacing
| distinct DeviceId;
// Collect all vulnerabilities for wich an exploit is available
let ExploitableVulnerabilities = DeviceTvmSoftwareVulnerabilitiesKB
| where IsExploitAvailable == 1
| project CveId;
DeviceTvmSoftwareVulnerabilities
| where CveId in~ (ExploitableVulnerabilities)
| where DeviceId in~ (InternetFacingDevices)
// Summarize results to get the stastics for each device
| summarize TotalExploitableVulnerabilities = dcount(CveId), CveIds = make_set(CveId), SoftwareNames = make_set(SoftwareName), RecommendedSecurityUpdates = make_set(RecommendedSecurityUpdate) by DeviceName
| sort by TotalExploitableVulnerabilities
```
:exclamation: **NOT** *available in Sentinel yet.*

### [+] Description
This query finds any Public Facing Devices with Vulnerabilties. Important to patch public-facing devices such as web servers, as they are often targeted by attackers looking to exploit vulnerabilities and gain unauthorized access. Patching these devices can help prevent successful attacks and protect sensitive data from being compromised. Additionally, failure to patch public-facing devices can result in downtime or service disruptions, which can negatively impact the reputation and revenue of an organization

### [+] Recommended Actions
1. Review the list of vulnerabilities detected on each device and prioritize remediation efforts based on the severity and criticality of the vulnerabilities to the team who handles vulnerability management or patching.
2. Ensure to tell that team who is responsible to reach out to the end user to ensure that they are aware of the vulnerability and schedule a time to remediate the issue. If necessary, escalate the issue to the appropriate IT or security team.

### [+] Resources
- Forked from directly from [@Bert-JanP](https://github.com/Bert-JanP), please give him credit and a follow!
- [MDE Discovering Internet-Faced Devices](https://techcommunity.microsoft.com/t5/microsoft-defender-for-endpoint/discovering-internet-facing-devices-using-microsoft-defender-for/ba-p/3778975)
