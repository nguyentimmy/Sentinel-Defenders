# File in Application Containing Malware

### [+] Defender for Endpoint 
```
CloudAppEvents
| where ActionType == "FileMalwareDetected"
| extend FileName = parse_json(RawEventData).['SourceFileName']
| extend SiteUrl = parse_json(RawEventData).['SiteUrl']
| extend VirusVendor = parse_json(RawEventData).['VirusVendor']
| extend VirusInfo = parse_json(RawEventData).['VirusInfo']
| project Timestamp, Application, VirusInfo, ObjectName, FileName, VirusVendor, IPAddress
```

### [+] Sentinel
```
CloudAppEvents
| where ActionType == "FileMalwareDetected"
| extend FileName = parse_json(RawEventData).['SourceFileName']
| extend SiteUrl = parse_json(RawEventData).['SiteUrl']
| extend VirusVendor = parse_json(RawEventData).['VirusVendor']
| extend VirusInfo = parse_json(RawEventData).['VirusInfo']
| project TimeGenerated, Application, VirusInfo, ObjectName, FileName, VirusVendor, IPAddress
```
‚ùó You WILL need to turn on Microsoft 365 Defender or Microsoft Defender for Endpoint Data connector on Sentinel in order for this KQL to work.

### [+] Description
Query detects malware in an cloud application or software. 

### [+] Recommended Actions
1. If a malware is detected in any results, it is recommended to investigate the affected devices and isolate them from the network to prevent the spread of the malware.

### [+] Resources
- Forked from directly from [@Bert-JanP](https://github.com/Bert-JanP), with a few modifications, please give him credit and a follow!
